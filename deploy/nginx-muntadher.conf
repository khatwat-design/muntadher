# Nginx — توجيه الدومين الفرعي لتطبيق منتظر (muntadher)
# الملف المقترح: /etc/nginx/sites-available/muntadher أو داخل conf.d
#
# 1) انسخ الملف: sudo cp deploy/nginx-muntadher.conf /etc/nginx/sites-available/muntadher
# 2) عدّل server_name و proxy_pass إن لزم (البورت حسب .env أو 3001)
# 3) فعّل: sudo ln -sf /etc/nginx/sites-available/muntadher /etc/nginx/sites-enabled/
# 4) اختبر: sudo nginx -t
# 5) أعد تحميل: sudo systemctl reload nginx

server {
    listen 80;
    server_name muntadher.example.com;   # غيّر إلى الدومين الفرعي الفعلي (مثلاً muntadher.khatwat-design.com)

    root /var/www/muntadher/dist;        # غيّر إلى مسار المشروع على السيرفر (مثلاً /root/muntadher/dist)
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://127.0.0.1:4001;   # بورت منفصل عن نظام خطوات (مثلاً 4001)
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}

# لتفعيل HTTPS لاحقاً (Let's Encrypt):
# sudo certbot --nginx -d muntadher.example.com
